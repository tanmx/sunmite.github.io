<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon_32x32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_32x32.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="p-xBdBlsApXFuMJI3CuE7U5-tTxoULqLOVncnqxQ7cQ"><meta name="msvalidate.01" content="BF242B99BF281AFA7EA9899CD017DD41"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.sunmite.com",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="一个默默无闻的工程师的日常"><meta property="og:type" content="website"><meta property="og:title" content="谭明宵博客"><meta property="og:url" content="https://www.sunmite.com/page/3/index.html"><meta property="og:site_name" content="谭明宵博客"><meta property="og:description" content="一个默默无闻的工程师的日常"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="tanmx"><meta property="article:tag" content="“Hexo, OpenStack, Linux, VMware, Docker, Kubernetes, Python, Crawler”"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.sunmite.com/page/3/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>谭明宵博客 - Every day is May day!</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="谭明宵博客" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">谭明宵博客</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Every day is May day!</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/linux/from-typecho-to-hexo.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/linux/from-typecho-to-hexo.html" class="post-title-link" itemprop="url">博客从 typecho 迁移到 Hexo</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-02-11 20:32:00" itemprop="dateCreated datePublished" datetime="2018-02-11T20:32:00+08:00">2018-02-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-03-04 12:26:00" itemprop="dateModified" datetime="2020-03-04T12:26:00+08:00">2020-03-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span><span id="/linux/from-typecho-to-hexo.html" class="post-meta-item leancloud_visitors" data-flag-title="博客从 typecho 迁移到 Hexo" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/linux/from-typecho-to-hexo.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/linux/from-typecho-to-hexo.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="Hexo-环境搭建"><a href="#Hexo-环境搭建" class="headerlink" title="Hexo 环境搭建"></a>Hexo 环境搭建</h2><p>使用 <a target="_blank" rel="noopener" href="https://coding.net/pages/">coding</a> 和 <a target="_blank" rel="noopener" href="https://pages.github.com/">github.io</a> 的 pages 服务，绑定了自己的域名，做了双线解析，国内用户解析到 coding ,国外用户解析到 github.io，访问速度很满意(本来就是静态文件，访问速度很快)。<br>Hexo 环境的搭建，这里不再赘述，主要介绍如何导出 typecho 的数据和 Hexo 站点的配置以及 Next 主题的配置及优化。</p><h2 id="typecho-数据导出"><a href="#typecho-数据导出" class="headerlink" title="typecho 数据导出"></a>typecho 数据导出</h2><h3 id="文章数据的导出"><a href="#文章数据的导出" class="headerlink" title="文章数据的导出"></a>文章数据的导出</h3><p>花了点时间把 typecho 的文章全部改写成 Markdown 的格式，方便我导出为 md 文件，使用了 github 上面一个开源的 python 项目 <a target="_blank" rel="noopener" href="https://github.com/zhourongyu/Typecho2Hexo">Typecho2Hexo</a> 进行 typecho 文章数据的导出。稍微修改后如下所示:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torndb</span><br><span class="line"><span class="keyword">import</span> arrow</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_data</span>(<span class="params">db</span>):</span></span><br><span class="line">    <span class="comment"># 创建分类和标签</span></span><br><span class="line">    categories = db.query(<span class="string">&quot;select type, slug, name from typecho_metas&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> cate <span class="keyword">in</span> categories:</span><br><span class="line">        path = <span class="string">&#x27;data/%s&#x27;</span> % cate.slug</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">            os.makedirs(path)</span><br><span class="line">        f = codecs.<span class="built_in">open</span>(<span class="string">&#x27;%s/index.md&#x27;</span> % path, <span class="string">&#x27;w&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;title: %s\n&quot;</span> % cate.slug)</span><br><span class="line">        f.write(<span class="string">&quot;date: %s\n&quot;</span> % arrow.now().<span class="built_in">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>))</span><br><span class="line">        <span class="comment"># 区分分类和标签</span></span><br><span class="line">        <span class="keyword">if</span> cate.<span class="built_in">type</span> == <span class="string">&#x27;category&#x27;</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;type: &quot;categories&quot;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> cate.<span class="built_in">type</span> == <span class="string">&#x27;tags&#x27;</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;type: &quot;tags&quot;\n&#x27;</span>)</span><br><span class="line">        <span class="comment"># 禁止评论</span></span><br><span class="line">        f.write(<span class="string">&quot;comments: true\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建文章</span></span><br><span class="line">    entries = db.query(<span class="string">&quot;select cid, title, slug, text, created from typecho_contents where type=&#x27;post&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> entries:</span><br><span class="line">        title = e.title</span><br><span class="line">        urlname = e.slug</span><br><span class="line">        print(title)</span><br><span class="line">        content = <span class="built_in">str</span>(e.text).replace(<span class="string">&#x27;&lt;!--markdown--&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        tags = []</span><br><span class="line">        category = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 找出文章的tag及category</span></span><br><span class="line">        metas = db.query(</span><br><span class="line">            <span class="string">&quot;select type, name, slug from `typecho_relationships` ts, typecho_metas tm where tm.mid = ts.mid and ts.cid = %s&quot;</span>,</span><br><span class="line">            e.cid)</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> metas:</span><br><span class="line">            <span class="keyword">if</span> m.<span class="built_in">type</span> == <span class="string">&#x27;tag&#x27;</span>:</span><br><span class="line">                tags.append(m.name)</span><br><span class="line">            <span class="keyword">if</span> m.<span class="built_in">type</span> == <span class="string">&#x27;category&#x27;</span>:</span><br><span class="line">                category = m.slug</span><br><span class="line">        path = <span class="string">&#x27;data/_posts/&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">            os.makedirs(path)</span><br><span class="line">        f = codecs.<span class="built_in">open</span>(<span class="string">r&quot;%s%s.md&quot;</span> % (path,title), <span class="string">&#x27;w&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        f.write(<span class="string">&quot;title: %s\n&quot;</span> % title)</span><br><span class="line">        f.write(<span class="string">&quot;date: %s\n&quot;</span> % arrow.get(e.created).<span class="built_in">format</span>(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>))</span><br><span class="line">        f.write(<span class="string">&quot;categories: %s\n&quot;</span> % category)</span><br><span class="line">        f.write(<span class="string">&quot;tags: [%s]\n&quot;</span> % <span class="string">&#x27;,&#x27;</span>.join(tags))</span><br><span class="line">        f.write(<span class="string">&quot;urlname: %s\n&quot;</span> % urlname)</span><br><span class="line">        f.write(<span class="string">&quot;---\n&quot;</span>)</span><br><span class="line">        f.write(content)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 把数据库连接信息</span></span><br><span class="line">    db = torndb.Connection(host=<span class="string">&quot;******&quot;</span>, database=<span class="string">&quot;******&quot;</span>, user=<span class="string">&quot;******&quot;</span>, password=<span class="string">&quot;******&quot;</span>)</span><br><span class="line">    create_data(db)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/linux/from-typecho-to-hexo.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/linux/Mining-program.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/linux/Mining-program.html" class="post-title-link" itemprop="url">第一次遭遇挖矿程序</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-29 09:42:00" itemprop="dateCreated datePublished" datetime="2018-01-29T09:42:00+08:00">2018-01-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span><span id="/linux/Mining-program.html" class="post-meta-item leancloud_visitors" data-flag-title="第一次遭遇挖矿程序" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/linux/Mining-program.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/linux/Mining-program.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><h3 id="1-两台服务器收到告警，top-查看进程发现如下可疑进程"><a href="#1-两台服务器收到告警，top-查看进程发现如下可疑进程" class="headerlink" title="1. 两台服务器收到告警，top 查看进程发现如下可疑进程"></a>1. 两台服务器收到告警，top 查看进程发现如下可疑进程</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># top</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">PID</span> USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line"><span class="attribute">19078</span> vmuser    <span class="number">20</span>   <span class="number">0</span>  <span class="number">680232</span>  <span class="number">14284</span>   <span class="number">1032</span> S <span class="number">342</span>.<span class="number">8</span>  <span class="number">0</span>.<span class="number">1</span>   <span class="number">1583</span>:<span class="number">11</span> md</span><br><span class="line"><span class="attribute">501</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3264</span>    <span class="number">760</span> R  <span class="number">55</span>.<span class="number">9</span>  <span class="number">0</span>.<span class="number">0</span>   <span class="number">2172</span>:<span class="number">49</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">504</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3264</span>    <span class="number">760</span> R  <span class="number">46</span>.<span class="number">7</span>  <span class="number">0</span>.<span class="number">0</span>   <span class="number">2000</span>:<span class="number">21</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">18469</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3504</span>    <span class="number">984</span> R  <span class="number">46</span>.<span class="number">1</span>  <span class="number">0</span>.<span class="number">0</span>   <span class="number">1252</span>:<span class="number">47</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">18692</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3408</span>    <span class="number">908</span> R  <span class="number">43</span>.<span class="number">1</span>  <span class="number">0</span>.<span class="number">0</span> <span class="number">318</span>:<span class="number">58</span>.<span class="number">87</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">18695</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3536</span>   <span class="number">1020</span> R  <span class="number">42</span>.<span class="number">8</span>  <span class="number">0</span>.<span class="number">0</span> <span class="number">129</span>:<span class="number">26</span>.<span class="number">05</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">10547</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3412</span>    <span class="number">908</span> R  <span class="number">40</span>.<span class="number">8</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">72</span>:<span class="number">19</span>.<span class="number">69</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">8658</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3400</span>    <span class="number">880</span> R  <span class="number">40</span>.<span class="number">5</span>  <span class="number">0</span>.<span class="number">0</span>   <span class="number">4606</span>:<span class="number">03</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">8655</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3468</span>    <span class="number">948</span> R  <span class="number">40</span>.<span class="number">1</span>  <span class="number">0</span>.<span class="number">0</span>   <span class="number">4383</span>:<span class="number">23</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">10542</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3408</span>    <span class="number">908</span> S  <span class="number">24</span>.<span class="number">7</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">90</span>:<span class="number">27</span>.<span class="number">13</span><span class="meta"> [atd]</span></span><br><span class="line"><span class="attribute">8549</span> vmuser    <span class="number">20</span>   <span class="number">0</span>   <span class="number">32348</span>   <span class="number">3372</span>    <span class="number">868</span> R   <span class="number">9</span>.<span class="number">9</span>  <span class="number">0</span>.<span class="number">0</span> <span class="number">323</span>:<span class="number">27</span>.<span class="number">79</span><span class="meta"> [atd]</span></span><br></pre></td></tr></table></figure><p>用户名为 vmuser 的可疑进程</p><h3 id="2-查看-md-进程详情"><a href="#2-查看-md-进程详情" class="headerlink" title="2. 查看 md 进程详情"></a>2. 查看 md 进程详情</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ps aux | grep 19078</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">vmuser</span>   <span class="number">19078</span>  <span class="number">343</span>  <span class="number">0</span>.<span class="number">0</span> <span class="number">680232</span> <span class="number">13764</span> ?        Sl   <span class="number">07</span>:<span class="number">38</span> <span class="number">1613</span>:<span class="number">58</span> -bash -a cryptonight -o stratum+tcp://etn-us-west<span class="number">1</span>.nanopool.org:<span class="number">13333</span> -u etnk<span class="number">5</span>c<span class="number">12</span>V<span class="number">3</span>YAb<span class="number">5</span>gLekc<span class="number">5</span>N<span class="number">8</span>SizEpbpDogviaU<span class="number">2</span>U<span class="number">9</span>tff<span class="number">2</span>F<span class="number">9</span>JafNFS<span class="number">9</span>pxmF<span class="number">1</span>PNf<span class="number">4</span>aZrMjRSqd<span class="number">9</span>bhjXn<span class="number">7</span>dbpmepNjKi<span class="number">586</span>ZtD<span class="number">9</span>Cv<span class="number">9</span>N -p x</span><br></pre></td></tr></table></figure><p>查询后果然和自己判断一样是一个挖矿程序</p><div class="post-button"> <a class="btn" href="/linux/Mining-program.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/python/douban-file-top250.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/python/douban-file-top250.html" class="post-title-link" itemprop="url">获取豆瓣电影TOP 250并存入文件</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-25 10:05:00" itemprop="dateCreated datePublished" datetime="2018-01-25T10:05:00+08:00">2018-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span></span><span id="/python/douban-file-top250.html" class="post-meta-item leancloud_visitors" data-flag-title="获取豆瓣电影TOP 250并存入文件" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/python/douban-file-top250.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/python/douban-file-top250.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line">DOWNLOAD_URL = <span class="string">&#x27;http://movie.douban.com/top250&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_page</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0&#x27;</span>&#125;</span><br><span class="line">    data = requests.get(url, headers=headers).content</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_html</span>(<span class="params">html</span>):</span></span><br><span class="line">    <span class="comment">#更换解析器，详情 https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.zh.html#id9</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">&quot;lxml&quot;</span>)</span><br><span class="line">    movies_list_soup = soup.find(<span class="string">&#x27;ol&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;grid_view&#x27;</span>&#125;)</span><br><span class="line">    movie_name_list = []</span><br><span class="line">    movie_rating_num_list = []</span><br><span class="line">    movie_quote_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> movies_li <span class="keyword">in</span> movies_list_soup.find_all(<span class="string">&#x27;li&#x27;</span>):</span><br><span class="line">        movie_name = movies_li.find(<span class="string">&#x27;div&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;hd&#x27;</span>&#125;).find(<span class="string">&#x27;span&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;title&#x27;</span>&#125;).getText()</span><br><span class="line">        movie_rating = movies_li.find(<span class="string">&#x27;div&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;bd&#x27;</span>&#125;).find(<span class="string">&#x27;span&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;rating_num&#x27;</span>,</span><br><span class="line">                                                                                        <span class="string">&#x27;property&#x27;</span>: <span class="string">&#x27;v:average&#x27;</span>&#125;).getText()</span><br><span class="line">        <span class="comment">#movie_quote = movies_li.find(&#x27;div&#x27;, attrs=&#123;&#x27;class&#x27;: &#x27;bd&#x27;&#125;).find(&#x27;span&#x27;, attrs=&#123;&#x27;class&#x27;: &#x27;inq&#x27;&#125;).getText()</span></span><br><span class="line">        movie_quote_obj = movies_li.find(<span class="string">&#x27;div&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;bd&#x27;</span>&#125;).find(<span class="string">&#x27;span&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;inq&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment">### 发现某部电影评价为空，此处判断评价是否为空</span></span><br><span class="line">        <span class="keyword">if</span> movie_quote_obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            movie_quote = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            movie_quote = movie_quote_obj.getText()</span><br><span class="line"></span><br><span class="line">        movie_name_list.append(movie_name)</span><br><span class="line">        movie_rating_num_list.append(movie_rating)</span><br><span class="line">        movie_quote_list.append(movie_quote)</span><br><span class="line"></span><br><span class="line">    next_page = soup.find(<span class="string">&#x27;span&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;next&#x27;</span>&#125;).find(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> next_page:</span><br><span class="line">        <span class="keyword">return</span> movie_name_list, movie_rating_num_list, movie_quote_list, DOWNLOAD_URL + next_page[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> movie_name_list, movie_rating_num_list, movie_quote_list, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    url = DOWNLOAD_URL</span><br><span class="line">    <span class="comment">#utf_8_sig 解决windows下csv文件乱码问题</span></span><br><span class="line">    <span class="keyword">with</span> codecs.<span class="built_in">open</span>(<span class="string">&#x27;movies_top_250.csv&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>, encoding=<span class="string">&#x27;utf_8_sig&#x27;</span>) <span class="keyword">as</span> csvFile:</span><br><span class="line">        writer = csv.writer(csvFile)</span><br><span class="line">        writer.writerow((<span class="string">u&#x27;电影名&#x27;</span>, <span class="string">u&#x27;评分&#x27;</span>, <span class="string">u&#x27;理由&#x27;</span>))</span><br><span class="line">        <span class="keyword">while</span> url:</span><br><span class="line">            html = download_page(url)</span><br><span class="line">            movies, rating, quote, url = parse_html(html)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(movies)):</span><br><span class="line">                writer.writerow((movies[i], rating[i], quote[i]))</span><br><span class="line">                </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/ceilometer-gnocchi.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/ceilometer-gnocchi.html" class="post-title-link" itemprop="url">openstack ocata部署ceilometer+gnocchi</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-25 09:26:00" itemprop="dateCreated datePublished" datetime="2018-01-25T09:26:00+08:00">2018-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/ceilometer-gnocchi.html" class="post-meta-item leancloud_visitors" data-flag-title="openstack ocata部署ceilometer+gnocchi" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/ceilometer-gnocchi.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/ceilometer-gnocchi.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="安装Gnocchi"><a href="#安装Gnocchi" class="headerlink" title="安装Gnocchi"></a>安装Gnocchi</h1><h2 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h2><h3 id="1-完成以下步骤，创建数据库"><a href="#1-完成以下步骤，创建数据库" class="headerlink" title="1. 完成以下步骤，创建数据库"></a>1. 完成以下步骤，创建数据库</h3><ul><li>使用 root 用户登录数据库<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>mysql -u root -p</span><br></pre></td></tr></table></figure></li><li>创建 gnocchi 数据库<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> gnocchi;</span><br></pre></td></tr></table></figure></li><li>配置 gnocchi 数据库权限（这里密码为 GNOCCHI_DBPASS，按需修改）<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">&gt; <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> gnocchi.* <span class="keyword">TO</span> <span class="string">&#x27;gnocchi&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;GNOCCHI_DBPASS&#x27;</span>;</span><br><span class="line">&gt; <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> gnocchi.* <span class="keyword">TO</span> <span class="string">&#x27;gnocchi&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;GNOCCHI_DBPASS&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>退出数据库</li></ul><h3 id="2-加载-admin-用户认证文件"><a href="#2-加载-admin-用户认证文件" class="headerlink" title="2. 加载 admin 用户认证文件"></a>2. 加载 admin 用户认证文件</h3><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>. admin-openrc</span><br></pre></td></tr></table></figure><h3 id="3-完成以下步骤创建服务认证"><a href="#3-完成以下步骤创建服务认证" class="headerlink" title="3. 完成以下步骤创建服务认证"></a>3. 完成以下步骤创建服务认证</h3><ul><li>创建 gnocchi 用户（用户密码为 GNOCCHI_PASS）<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ openstack <span class="keyword">user</span> <span class="title">create</span> --domain default --password-prompt gnocchi</span><br></pre></td></tr></table></figure></li><li>为 gnocchi 用户增加 admin 的角色<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">$ openstack <span class="keyword">role</span> <span class="title">add</span> --project service --<span class="keyword">user</span> <span class="title">gnocchi</span> admin</span><br></pre></td></tr></table></figure></li><li>创建 gnocchi 服务实体<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line">$ <span class="string">openstack</span> <span class="string">service</span> <span class="string">create</span> <span class="built_in">--name</span> <span class="string">gnocchi</span> <span class="built_in">--description</span> <span class="string">&quot;Metric Service&quot;</span> <span class="string">metric</span> </span><br></pre></td></tr></table></figure></li></ul><ol start="4"><li>创建 gnocchi 服务API endpoints<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">$ openstack endpoint <span class="keyword">create</span> --region RegionOne metric <span class="keyword">public</span> http:<span class="comment">//controller:8041</span></span><br><span class="line">$ openstack endpoint <span class="keyword">create</span> --region RegionOne metric internal http:<span class="comment">//controller:8041</span></span><br><span class="line">$ openstack endpoint <span class="keyword">create</span> --region RegionOne metric admin http:<span class="comment">//controller:8041</span></span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/openstack/ceilometer-gnocchi.html#more" rel="contents">阅读全文 &raquo;</a></div></li></ol></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/rabbitmq-can-not-join-cluster.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/rabbitmq-can-not-join-cluster.html" class="post-title-link" itemprop="url">rabbitmq无法重新加入集群，启动失败的问题</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-25 09:13:00" itemprop="dateCreated datePublished" datetime="2018-01-25T09:13:00+08:00">2018-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/rabbitmq-can-not-join-cluster.html" class="post-meta-item leancloud_visitors" data-flag-title="rabbitmq无法重新加入集群，启动失败的问题" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/rabbitmq-can-not-join-cluster.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/rabbitmq-can-not-join-cluster.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>原有的 rabbitmq 集群出现问题，无法启动，尝试删除 /var/lib/rabbitmq/.erlang.cookie 重新组集群，依旧无法启动</p><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment"># systemctl start rabbitmq-server.service</span></span><br><span class="line">Job <span class="keyword">for</span> rabbitmq-server.service failed because <span class="keyword">the</span> control <span class="built_in">process</span> exited <span class="keyword">with</span> error code. See <span class="string">&quot;systemctl status rabbitmq-server.service&quot;</span> <span class="keyword">and</span> <span class="string">&quot;journalctl -xe&quot;</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure><h3 id="解决分析"><a href="#解决分析" class="headerlink" title="解决分析"></a>解决分析</h3><p>查看错误日志</p><figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line"><span class="meta"># journalctl -xe</span></span><br><span class="line">-- Subject: Unit rabbitmq-<span class="keyword">server</span>.service has begun start-up</span><br><span class="line">-- Defined-By: systemd</span><br><span class="line">-- Support: http:<span class="comment">//lists.freedesktop.org/mailman/listinfo/systemd-devel</span></span><br><span class="line">-- </span><br><span class="line">-- Unit rabbitmq-<span class="keyword">server</span>.service has begun starting up.</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: BOOT FAILED</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: ===========</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: Error description:</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;error,&#123;inconsistent_cluster,<span class="string">&quot;Node rabbit@controller03 thinks it&#x27;s clustered with node rabbit@controller02, but rabbit@controller02 disagrees&quot;</span>&#125;&#125;</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: Log files (may contain more information):</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: /<span class="built_in">var</span>/log/rabbitmq/rabbit@controller03.log</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: /<span class="built_in">var</span>/log/rabbitmq/rabbit@controller03-sasl.log</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: Stack trace:</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: [&#123;rabbit_mnesia,check_cluster_consistency,<span class="number">0</span>,</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: [&#123;file,<span class="string">&quot;src/rabbit_mnesia.erl&quot;</span>&#125;,&#123;line,<span class="number">598</span>&#125;]&#125;,</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;rabbit,<span class="string">&#x27;-boot/0-fun-0-&#x27;</span>,<span class="number">0</span>,[&#123;file,<span class="string">&quot;src/rabbit.erl&quot;</span>&#125;,&#123;line,<span class="number">275</span>&#125;]&#125;,</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;rabbit,start_it,<span class="number">1</span>,[&#123;file,<span class="string">&quot;src/rabbit.erl&quot;</span>&#125;,&#123;line,<span class="number">296</span>&#125;]&#125;,</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;init,start_it,<span class="number">1</span>,[]&#125;,</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">20</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;init,start_em,<span class="number">1</span>,[]&#125;]</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">21</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: &#123;<span class="string">&quot;init terminating in do_boot&quot;</span>,&#123;error,&#123;inconsistent_cluster,<span class="string">&quot;Node rabbit@controller03 thinks it&#x27;s clustered with node rabbit@controller02, but rabbit@controller02 disagrees&quot;</span>&#125;&#125;&#125;</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">21</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: init terminating <span class="keyword">in</span> do_boot ()</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">22</span> controller03 rabbitmq-<span class="keyword">server</span>[<span class="number">13522</span>]: Crash dump <span class="keyword">is</span> being written to: erl_crash.dump...done</span><br><span class="line">Nov <span class="number">24</span> <span class="number">14</span>:<span class="number">26</span>:<span class="number">22</span> controller03 systemd[<span class="number">1</span>]: rabbitmq-<span class="keyword">server</span>.service: main process exited, code=exited, status=<span class="number">1</span>/FAILURE</span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/openstack/rabbitmq-can-not-join-cluster.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/rabbitmq-network-partition.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/rabbitmq-network-partition.html" class="post-title-link" itemprop="url">RabbitMQ Network Partition</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-24 09:14:00" itemprop="dateCreated datePublished" datetime="2018-01-24T09:14:00+08:00">2018-01-24</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/rabbitmq-network-partition.html" class="post-meta-item leancloud_visitors" data-flag-title="RabbitMQ Network Partition" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/rabbitmq-network-partition.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/rabbitmq-network-partition.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>线上的rabbitmq集群经常无法访问，集群状态也不正常，查找到如下资料：</p><h3 id="一-环境概述"><a href="#一-环境概述" class="headerlink" title="一. 环境概述"></a>一. 环境概述</h3><h4 id="1-3个rabbitmq-node组成的集群镜像，当客户端无法连接或者连接rabbitmq超时的时候，集群的状态如下："><a href="#1-3个rabbitmq-node组成的集群镜像，当客户端无法连接或者连接rabbitmq超时的时候，集群的状态如下：" class="headerlink" title="1. 3个rabbitmq node组成的集群镜像，当客户端无法连接或者连接rabbitmq超时的时候，集群的状态如下："></a>1. 3个rabbitmq node组成的集群镜像，当客户端无法连接或者连接rabbitmq超时的时候，集群的状态如下：</h4><figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rabbitmqctl cluster_status</span></span><br><span class="line">Cluster status of node rabbit@controller02 ...</span><br><span class="line">[&#123;nodes,[&#123;disc,[rabbit@controller01]&#125;,</span><br><span class="line">         &#123;ram,[rabbit@controller03,rabbit@controller02]&#125;]&#125;,</span><br><span class="line"> &#123;running_nodes,[rabbit@controller03,rabbit@controller02]&#125;,</span><br><span class="line"> &#123;cluster_name,&lt;&lt;<span class="string">&quot;rabbit@controller01&quot;</span>&gt;&gt;&#125;,</span><br><span class="line"> &#123;partitions,[&#123;rabbit@controller02,[rabbit@controller01]&#125;]&#125;,</span><br><span class="line"> &#123;alarms,[&#123;rabbit@controller03,[]&#125;,&#123;rabbit@controller02,[]&#125;]&#125;]</span><br></pre></td></tr></table></figure><p>可以看到partitions中有内容，发生了网络分区。</p><div class="post-button"> <a class="btn" href="/openstack/rabbitmq-network-partition.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/use-rally-to-openstack-tempest-test.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/use-rally-to-openstack-tempest-test.html" class="post-title-link" itemprop="url">通过 Rally 进行 OpenStack Tempest 测试</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-09-04 08:33:07" itemprop="dateCreated datePublished" datetime="2017-09-04T08:33:07+08:00">2017-09-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/use-rally-to-openstack-tempest-test.html" class="post-meta-item leancloud_visitors" data-flag-title="通过 Rally 进行 OpenStack Tempest 测试" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/use-rally-to-openstack-tempest-test.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/use-rally-to-openstack-tempest-test.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="Rally-基本介绍"><a href="#Rally-基本介绍" class="headerlink" title="Rally 基本介绍"></a>Rally 基本介绍</h2><p>Rally 是OpenStack社区推出开源测试工具，可用于对OpenStack各个组件进行性能测试。通过使用Rally组件，用户可完成OpenStack云计算平台的安装部署、功能验证、大规模负载测试(性能测试)、输出测试报告等一系列动作。<br>Rally 的概况和结构如下图所示：<br><img data-src="/images/uploads/2017/09/2916469037.png" alt="image"><br>Rally 主要包括三大部分：</p><ul><li>Deploy engine：这不是一个真的部署工具，它只是一个插件形式的东西，它可以和其他部署工具（比如 DevStack，Fuel，Anvil 等）一起工作来简化和统一部署流程。</li><li>Verification：使用tempest验证已经部署的openstack云环境的功能。</li><li>Benchmark engine：性能测试</li></ul><h2 id="Tempest-基本介绍"><a href="#Tempest-基本介绍" class="headerlink" title="Tempest 基本介绍"></a>Tempest 基本介绍</h2><p>Tempest 是一个旨在为云计算平台 OpenStack 提供集成功能测试的开源项目，包含了 Openstack 基本组件（nova, keystone, glance, neutron, cinder 等）的 API 测试用例与场景。它是基于 unittest2 和 nose 建立的，灵活且易于扩展及维护，使得 OpenStack 相关测试效率得到大幅度提升。</p><h2 id="安装-Rally"><a href="#安装-Rally" class="headerlink" title="安装 Rally"></a>安装 Rally</h2><div class="post-button"> <a class="btn" href="/openstack/use-rally-to-openstack-tempest-test.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/docker/use-docker-deploy-ceph.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/docker/use-docker-deploy-ceph.html" class="post-title-link" itemprop="url">使用 docker 快速部署 ceph</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-06-19 06:34:00" itemprop="dateCreated datePublished" datetime="2017-06-19T06:34:00+08:00">2017-06-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span></span><span id="/docker/use-docker-deploy-ceph.html" class="post-meta-item leancloud_visitors" data-flag-title="使用 docker 快速部署 ceph" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/docker/use-docker-deploy-ceph.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/docker/use-docker-deploy-ceph.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><ul><li>至少需要三台虚拟机或者物理机，这里使用虚拟机</li><li>每台虚拟机至少需要两块硬盘（一块系统盘，一块OSD），本例中有三块硬盘</li></ul><h3 id="1-部署流程"><a href="#1-部署流程" class="headerlink" title="1. 部署流程"></a>1. 部署流程</h3><p>博客使用的markdown解析器不支持流程图使用图片代替<br><img data-src="/images/uploads/2017/06/89293182.png" alt="liuchengtu.png"></p><h3 id="2-主机规划"><a href="#2-主机规划" class="headerlink" title="2. 主机规划"></a>2. 主机规划</h3><p><img data-src="/images/uploads/2017/06/419662942.png" alt="biaoge.png"></p><h2 id="安装-docker"><a href="#安装-docker" class="headerlink" title="安装 docker"></a>安装 docker</h2><p>登录 <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/#/accelerator">https://cr.console.aliyun.com/#/accelerator</a> 获取自己的阿里云 docker 加速地址</p><h3 id="1-安装升级-docker-客户端"><a href="#1-安装升级-docker-客户端" class="headerlink" title="1. 安装升级 docker 客户端"></a>1. 安装升级 docker 客户端</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span></span><br></pre></td></tr></table></figure><h3 id="2-使用-docker-加速器"><a href="#2-使用-docker-加速器" class="headerlink" title="2. 使用 docker 加速器"></a>2. 使用 docker 加速器</h3><p>可以通过修改 daemon 配置文件 /etc/docker/daemon.json 来使用加速器，注意修改使用自己的加速地址</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mkdir -p /etc/docker</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://******.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl daemon-reload</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl restart docker</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl <span class="built_in">enable</span> docker</span></span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/docker/use-docker-deploy-ceph.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/devstack-turn-on-openstack-profiler.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/devstack-turn-on-openstack-profiler.html" class="post-title-link" itemprop="url">devstack dashboard 开启开发者选项 和 OpenStack Profiler</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-05-19 13:47:00" itemprop="dateCreated datePublished" datetime="2017-05-19T13:47:00+08:00">2017-05-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/devstack-turn-on-openstack-profiler.html" class="post-meta-item leancloud_visitors" data-flag-title="devstack dashboard 开启开发者选项 和 OpenStack Profiler" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/devstack-turn-on-openstack-profiler.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/devstack-turn-on-openstack-profiler.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>在ocata的版本中，引入了一个新的“openstack profiler”的面板，启用openstack profiler可以方便的看到访问horizon页面时的API调用情况。如下图所示：<br><img data-src="/images/uploads/2017/05/2821496612.png" alt="image"><br>下面介绍如何启用 openstack profiler，首先需要一个正常运行的devstack环境，启用方法如下</p><h3 id="安装mongoDB"><a href="#安装mongoDB" class="headerlink" title="安装mongoDB"></a>安装mongoDB</h3><p>Horizon会将API调用过程的数据都保存到mongodb中，mongodb可以安装在本机，也可以在本机能够访问的任意一台机器上。</p><h4 id="1-安装软件包"><a href="#1-安装软件包" class="headerlink" title="1. 安装软件包"></a>1. 安装软件包</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install mongodb-server mongodb -y</span></span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/openstack/devstack-turn-on-openstack-profiler.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.sunmite.com/openstack/ssh-key-login-problem.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="tanmx"><meta itemprop="description" content="一个默默无闻的工程师的日常"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="谭明宵博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/openstack/ssh-key-login-problem.html" class="post-title-link" itemprop="url">ssh 无密码访问的问题</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-05-10 10:12:00" itemprop="dateCreated datePublished" datetime="2017-05-10T10:12:00+08:00">2017-05-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span><span id="/openstack/ssh-key-login-problem.html" class="post-meta-item leancloud_visitors" data-flag-title="ssh 无密码访问的问题" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/openstack/ssh-key-login-problem.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/openstack/ssh-key-login-problem.html" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="ssh-无密码登录失败"><a href="#ssh-无密码登录失败" class="headerlink" title="ssh 无密码登录失败"></a>ssh 无密码登录失败</h3><p>虚拟机 resize 需要配置计算节点之间 nova 用户无密码访问，但是在配置过程中有一台始终不能用密钥登录，对比了正常可以无密码登录的日志如下。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 正常登录</span></span><br><span class="line">debug2: we did not send a packet, disable method</span><br><span class="line">debug3: authmethod_lookup publickey</span><br><span class="line">debug3: remaining preferred: keyboard-interactive,password</span><br><span class="line">debug3: authmethod_is_enabled publickey</span><br><span class="line">debug1: Next authentication method: publickey</span><br><span class="line">debug1: Offering RSA public key: /var/lib/nova/.ssh/id_rsa</span><br><span class="line">debug3: send_pubkey_test</span><br><span class="line">debug2: we sent a publickey packet, wait for reply</span><br><span class="line">debug1: Server accepts key: pkalg ssh-rsa blen 279</span><br></pre></td></tr></table></figure><div class="post-button"> <a class="btn" href="/openstack/ssh-key-login-problem.html#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a> <a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="tanmx" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">tanmx</p><div class="site-description" itemprop="description">一个默默无闻的工程师的日常</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">76</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/tanmx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tanmx" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:tanmingxiao@gmail.com" title="E-Mail → mailto:tanmingxiao@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://weibo.com/lovelongerlonger" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;lovelongerlonger" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/tan-ming-xiao" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tan-ming-xiao" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i> Zhihu</a></span><span class="links-of-author-item"><a href="https://twitter.com/lianyu_" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;lianyu_" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">tanmx</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://www.sunmite.com/page/3/',]
      });
      });
  </script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'PrhOstOSf2dO986Fj3hJLz4D-gzGzoHsz',
      appKey     : '1LuECitLMzy2tizSRV9k7oXW',
      placeholder: "(发表评论)",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></body></html>1-01-25 10:17:02" itemprop="dateModified" datetime="2021-01-25T10:17:02+08:00">2021-01-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a>
                </span>
            </span>

          
            <span id="/openstack/ssh-key-login-problem.html" class="post-meta-item leancloud_visitors" data-flag-title="ssh 无密码访问的问题" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/openstack/ssh-key-login-problem.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/openstack/ssh-key-login-problem.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ssh-无密码登录失败"><a href="#ssh-无密码登录失败" class="headerlink" title="ssh 无密码登录失败"></a>ssh 无密码登录失败</h3><p>虚拟机 resize 需要配置计算节点之间 nova 用户无密码访问，但是在配置过程中有一台始终不能用密钥登录，对比了正常可以无密码登录的日志如下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 正常登录</span></span><br><span class="line">debug2: we did not send a packet, disable method</span><br><span class="line">debug3: authmethod_lookup publickey</span><br><span class="line">debug3: remaining preferred: keyboard-interactive,password</span><br><span class="line">debug3: authmethod_is_enabled publickey</span><br><span class="line">debug1: Next authentication method: publickey</span><br><span class="line">debug1: Offering RSA public key: /var/lib/nova/.ssh/id_rsa</span><br><span class="line">debug3: send_pubkey_test</span><br><span class="line">debug2: we sent a publickey packet, wait for reply</span><br><span class="line">debug1: Server accepts key: pkalg ssh-rsa blen 279</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/openstack/ssh-key-login-problem.html#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <div>
        
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tanmx"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">tanmx</p>
  <div class="site-description" itemprop="description">一个默默无闻的工程师的日常</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">76</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tanmx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tanmx" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tanmingxiao@gmail.com" title="E-Mail → mailto:tanmingxiao@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/lovelongerlonger" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;lovelongerlonger" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/tan-ming-xiao" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;tan-ming-xiao" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/lianyu_" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;lianyu_" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tanmx</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://www.sunmite.com/page/3/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'PrhOstOSf2dO986Fj3hJLz4D-gzGzoHsz',
      appKey     : '1LuECitLMzy2tizSRV9k7oXW',
      placeholder: "(发表评论)",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
